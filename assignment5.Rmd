---
title: "assignment5"
author: "Rachel Green"
date: "November 27, 2018"
output: html_document
---

Setup Code:
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(car)
library(userfriendlyscience)
library(knitr)
library(kableExtra)
library(effsize)
library(ggrepel)
fs = read_csv("faculty_salary_data_2008_2009_survey.csv")
ge = read_csv("grad_enrollment.csv")
ms = read_csv("median_salary_doctoral_recipients.csv")
pf = read_csv("phds_by_field_1985_2015.csv")
```

Problem 1 (Jeremy):
```{r}
# Pink = "#0072B2" 
# Blue = "#56B4E9"
ge_trend = ggplot(ge, aes(x=year,y=total)) +
  geom_line() +
  geom_line(aes(y=fulltime_male)) +
  geom_line(aes(y=parttime_male, colour = "parttime_male")) +
  geom_text(aes(label = names(ge)))
ge_trend
```
Problem 1 (Michael):
```{r}
ge_adddecyear <- ge %>%
  mutate(year1 = year - min(year))

lm_gem1 <- lm(total_males ~ year1, data = ge_adddecyear)
summary(lm_gem1)

lm_gef1 <- lm(total_females ~ year1, data = ge_adddecyear)
summary(lm_gef1)

# predict from model over the same time domain
ge_year <- data.frame(year1 = c(0:48))
ge_year$year <- c(1967:2015)
predict_m <- as.data.frame(predict(lm_gem1, newdata = ge_year, se.fit = TRUE, interval="confidence"))
predict_f <- as.data.frame(predict(lm_gef1, newdata = ge_year, se.fit = TRUE, interval="confidence"))
names(predict_m) <- paste(names(predict_m), "m", sep = "_")
names(predict_f) <- paste(names(predict_f), "f", sep = "_")

ge_fullpred <- cbind(ge_adddecyear, predict_m, predict_f)

#ge_predm <- cbind(ge_year, predict_m)
#ge_predf <- cbind(ge_year, predict_f)

# plot
ge_plot <- ggplot(ge_fullpred, aes(x = year, y = total_females)) +
  geom_ribbon(aes(ymin = fit.lwr_f, ymax = fit.upr_f), fill = "tomato3", alpha = 0.35) +
  geom_ribbon(aes(ymin = fit.lwr_m, ymax = fit.upr_m), fill = "steelblue3", alpha = 0.35) +
  geom_point(color = "tomato2") +
  geom_point(aes(x = year, y = total_males), color = "steelblue3") + 
  geom_line(aes(x = year, y = fit.fit_f), color = "tomato2") +
  geom_line(aes(x = year, y = fit.fit_m), color = "steelblue3") +
  scale_x_continuous(limits = c(1965, 2015), expand=c(0,0)) +
  scale_y_continuous(limits = c(-100000, 2100000), expand=c(0,0)) +
  labs(y = "Total enrollment", x = "Year") +
  theme(legend.position = "top") +
  theme_classic()

ge_plot
```


Problem 2 (Rachel):
```{r}

pf_fem <- pf %>% 
  filter(field == "physical_science" | field == "engineering" | field == "education" | field == "humanities", sex == "F")
phd_shifts <- pf_fem %>% 
  ggplot(aes(x = year, y = number)) +
  geom_col(aes(fill = field), position = "dodge") +
  scale_x_continuous(expand=c(0,0), breaks = seq(1985,2015, by=15)) +
  scale_y_continuous(expand=c(0,0)) +
  theme_classic() +
  labs(
    x = "Year",
    y = "Female PhDs Awarded"
  )
phd_shifts

#chi-square (need to work on)
#phd_chi <- chisq.test(pf_fem) 
#phd_chi
```
Problem 2 (Michael):
```{r}
pf_f <- pf %>% 
  filter(field == "physical_science" | field == "engineering" | field == "education" | field == "humanities", sex == "F") %>%
  select(field, year, number) %>%
  spread(year, number) %>%
  select(-field)

rownames(pf_f) <- c("physical_science", "engineering", "education", "humanities")

pf_chisqf <- chisq.test(pf_f)
pf_chisqf

pf_fplt <- pf %>% 
  filter(field == "physical_science" | field == "engineering" | field == "education" | field == "humanities", sex == "F") %>%
  select(field, year, number)

pf_plt <- ggplot(pf_fplt, aes(x = field, y = number)) +
  geom_col(aes(fill = year), position = "dodge") +
  theme_classic()
pf_plt
```


Problem 3 (Rachel):
```{r}

#absolute difference in medians
#Employed Male/Female
emp_m_median <- median(ms$employment_male) #75167
emp_f_median <- median(ms$employment_female) #71750
emp_m_median - emp_f_median #3417
#Postdoc Male/Female
post_m_median <- median(ms$postdoc_male) #4800
post_f_median <- median(ms$postdoc_female) #4500
post_m_median - post_f_median # 3000

hist_emp_m = ggplot(ms, aes(ms$employment_male)) + geom_histogram()
qq_emp_m = ggplot(ms, aes(sample = ms$employment_male)) + geom_qq()

hist_emp_f = ggplot(ms, aes(ms$employment_female)) + geom_histogram()
qq_emp_f = ggplot(ms, aes(sample = ms$employment_female)) + geom_qq()

hist_post_m = ggplot(ms, aes(ms$postdoc_male)) + geom_histogram()
qq_post_m = ggplot(ms, aes(sample = ms$postdoc_male)) + geom_qq()

hist_post_f = ggplot(ms, aes(ms$postdoc_female)) + geom_histogram()
qq_post_f = ggplot(ms, aes(sample = ms$postdoc_female)) + geom_qq()

ftest_emp = var.test(ms$employment_male,ms$employment_female) # p=.88 thus variances are equal
ftest_post = var.test(ms$postdoc_male,ms$postdoc_female) # p=.85 thus variances are equal

#Mann-Whitney U
mwu_emp = wilcox.test(ms$employment_male,ms$employment_female)
mwu_emp # p = 0.3289 (not significant, ranks are equal)

mwu_post = wilcox.test(ms$postdoc_male,ms$postdoc_female)
mwu_post # p = 0.8671 (not significant, ranks are equal)

effsize_emp = cohen.d(ms$employment_male,ms$employment_female) # d estimate = 0.26 (small)
effsize_post = cohen.d(ms$postdoc_male,ms$postdoc_female) # d estimate = 0.04 (negligible)
```
Problem 3 (Jeremy):
```{r}

hist_emp_m = ggplot(ms, aes(ms$employment_male)) + geom_histogram()
hist_emp_f = ggplot(ms, aes(ms$employment_female)) + geom_histogram()
hist_post_m = ggplot(ms, aes(ms$postdoc_male)) + geom_histogram()
hist_post_f = ggplot(ms, aes(ms$postdoc_female)) + geom_histogram()

ftest_emp = var.test(ms$employment_male,ms$employment_female) # p=.88 thus variances are equal
ftest_post = var.test(ms$postdoc_male,ms$postdoc_female) # p=.85 thus variances are equal

ttest_emp = t.test(ms$employment_male,ms$employment_female, var.equal = T)
ttest_emp

ttest_post = t.test(ms$postdoc_male,ms$postdoc_female, var.equal = T)
ttest_post
```


Problem 4 (Rachel):
```{r}
# correlation of years since phd and years faculty service
yrs_corr <- fs %>% 
  ggplot(aes(x = years_since_PhD, y = years_faculty_service)) +
  geom_point(aes(color = sex), alpha = 0.5)
yrs_corr
#correlation years faculty service vs salary
service_corr <- fs %>% 
  ggplot(aes(x = years_faculty_service, y = salary)) +
  geom_point(aes(color = sex), alpha = 0.5)
service_corr

# Rank: reference level = profesor
fs$faculty_rank <- factor(fs$faculty_rank)
fs$faculty_rank <- fct_relevel(fs$faculty_rank, "Prof")
# aggregate model 
salary_lm1 <- lm(salary ~ faculty_rank + years_since_PhD + years_faculty_service + sex + discipline, data = fs)
vif(salary_lm1)
# years since PhD = 7.5
# years faculty service = 5.9
# others less than 4
# years since phd and years faculty service is a bit redundant so don't need both?
salary_lm2 <- lm(salary ~ faculty_rank + years_faculty_service + sex + discipline, data = fs)
vif(salary_lm2)
#AIC on both models 
AIC(salary_lm1) #9094
AIC(salary_lm2) #9097
#lm1 has a lower AIC, but need to use judgmement do decide (look more into papers, think about whether service and years since phd are both needed)
```

Problem 4 (Michael):
```{r}

```

Problem 4 (Jeremy):
```{r}

```








