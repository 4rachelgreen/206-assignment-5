---
title: "assignment5"
author: "Rachel Green"
date: "November 27, 2018"
output: html_document
---

Setup Code:
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(car)
library(userfriendlyscience)
library(knitr)
library(kableExtra)
library(effsize)
fs = read_csv("faculty_salary_data_2008_2009_survey.csv")
ge = read_csv("grad_enrollment.csv")
ms = read_csv("median_salary_doctoral_recipients.csv")
pf = read_csv("phds_by_field_1985_2015.csv")
```

Problem 1 (Jeremy):
```{r}

```
Problem 1 (Michael):
```{r}

```


Problem 2 (Rachel):
```{r}
pf_fem <- pf %>% 
  filter(field == "physical_science" | field == "engineering" | field == "education" | field == "humanities", sex == "F")
phd_shifts <- pf_fem %>% 
  ggplot(aes(x = year, y = number)) +
  geom_col(aes(fill = field), position = "dodge") +
  scale_x_continuous(expand=c(0,0), breaks = seq(1985,2015, by=15)) +
  scale_y_continuous(expand=c(0,0)) +
  theme_classic() +
  labs(
    x = "Year",
    y = "Female PhDs Awarded"
  )
phd_shifts

#chi-square (need to work on)
#phd_chi <- chisq.test(pf_fem) 
#phd_chi
```
Problem 2 (Michael):
```{r}

```


Problem 3 (Rachel):
```{r}
#absolute difference in medians
#Employed Male/Female
emp_m_median <- median(ms$employment_male) #75167
emp_f_median <- median(ms$employment_female) #71750
emp_m_median - emp_f_median #3417
#Postdoc Male/Female
post_m_median <- median(ms$postdoc_male) #4800
post_f_median <- median(ms$postdoc_female) #4500
post_m_median - post_f_median # 3000

hist_emp_m = ggplot(ms, aes(ms$employment_male)) + geom_histogram()
qq_emp_m = ggplot(ms, aes(sample = ms$employment_male)) + geom_qq()

hist_emp_f = ggplot(ms, aes(ms$employment_female)) + geom_histogram()
qq_emp_f = ggplot(ms, aes(sample = ms$employment_female)) + geom_qq()

hist_post_m = ggplot(ms, aes(ms$postdoc_male)) + geom_histogram()
qq_post_m = ggplot(ms, aes(sample = ms$postdoc_male)) + geom_qq()

hist_post_f = ggplot(ms, aes(ms$postdoc_female)) + geom_histogram()
qq_post_f = ggplot(ms, aes(sample = ms$postdoc_female)) + geom_qq()

ftest_emp = var.test(ms$employment_male,ms$employment_female) # p=.88 thus variances are equal
ftest_post = var.test(ms$postdoc_male,ms$postdoc_female) # p=.85 thus variances are equal

#Mann-Whitney U
mwu_emp = wilcox.test(ms$employment_male,ms$employment_female)
mwu_emp # p = 0.3289 (not significant, ranks are equal)

mwu_post = wilcox.test(ms$postdoc_male,ms$postdoc_female)
mwu_post # p = 0.8671 (not significant, ranks are equal)

effsize_emp = cohen.d(ms$employment_male,ms$employment_female) # d estimate = 0.26 (small)
effsize_post = cohen.d(ms$postdoc_male,ms$postdoc_female) # d estimate = 0.04 (negligible)
```
Problem 3 (Jeremy):
```{r}
hist_emp_m = ggplot(ms, aes(ms$employment_male)) + geom_histogram()
hist_emp_f = ggplot(ms, aes(ms$employment_female)) + geom_histogram()
hist_post_m = ggplot(ms, aes(ms$postdoc_male)) + geom_histogram()
hist_post_f = ggplot(ms, aes(ms$postdoc_female)) + geom_histogram()

ftest_emp = var.test(ms$employment_male,ms$employment_female) # p=.88 thus variances are equal
ftest_post = var.test(ms$postdoc_male,ms$postdoc_female) # p=.85 thus variances are equal

ttest_emp = t.test(ms$employment_male,ms$employment_female, var.equal = T)
ttest_emp

ttest_post = t.test(ms$postdoc_male,ms$postdoc_female, var.equal = T)
ttest_post
```


Problem 4 (Rachel):
```{r}
# correlation of years since phd and years faculty service
yrs_corr <- fs %>% 
  ggplot(aes(x = years_since_PhD, y = years_faculty_service)) +
  geom_point(aes(color = sex), alpha = 0.5)
yrs_corr
#correlation years faculty service vs salary
service_corr <- fs %>% 
  ggplot(aes(x = years_faculty_service, y = salary)) +
  geom_point(aes(color = sex), alpha = 0.5)
service_corr

# Rank: reference level = profesor
fs$faculty_rank <- factor(fs$faculty_rank)
fs$faculty_rank <- fct_relevel(fs$faculty_rank, "Prof")
# aggregate model 
salary_lm1 <- lm(salary ~ faculty_rank + years_since_PhD + years_faculty_service + sex + discipline, data = fs)
vif(salary_lm1)
# years since PhD = 7.5
# years faculty service = 5.9
# others less than 4
# years since phd and years faculty service is a bit redundant so don't need both?
salary_lm2 <- lm(salary ~ faculty_rank + years_faculty_service + sex + discipline, data = fs)
vif(salary_lm2)
#AIC on both models 
AIC(salary_lm1) #9094
AIC(salary_lm2) #9097
#lm1 has a lower AIC, but need to use judgmement do decide (look more into papers, think about whether service and years since phd are both needed)
```
```
Problem 4 (Michael):
```{r}

```
Problem 4 (Jeremy):
```{r}

```





